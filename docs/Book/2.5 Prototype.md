# Prototype Pattern

## Giới thiệu

Prototype là một Creational Design Pattern cho phép sao chép các đối tượng hiện có mà không làm ảnh hưởng đến code sử dụng đối tượng đó.

### Định nghĩa

Prototype Pattern định nghĩa một kiểu đối tượng (Prototype) để sao chép ra các đối tượng mới thông qua phương thức clone(). Các đối tượng mới này là bản sao của đối tượng gốc.

### Mục đích

- Tạo ra các đối tượng mới bằng cách sao chép từ một đối tượng hiện có.

- Tránh tạo đối tượng mới "từ đầu" nếu quá trình khởi tạo phức tạp và tốn kém.

- Che giấu logic khởi tạo phức tạp của đối tượng khỏi client.

## Đặt vấn đề

Giả sử bạn đang phát triển game, có lớp Character đại diện cho nhân vật trong game. Quá trình khởi tạo đối tượng Character rất phức tạp, bao gồm: load dữ liệu từ file, decode, sinh trang phục, vũ khí...

Tuy nhiên, có một số nhân vật chỉ khác nhau ở vài thuộc tính nhỏ. Lúc này việc khởi tạo đối tượng mới hoàn toàn từ đầu là lãng phí.

Ta cần một cách để tạo ra đối tượng mới thông qua việc sao chép từ đối tượng có sẵn.

## Giải quyết

Prototype Pattern giải quyết bài toán trên bằng cách:

- Định nghĩa một lớp Prototype có phương thức clone() dùng để tạo ra một bản sao của chính nó.

- Tạo một đối tượng ban đầu với quá trình khởi tạo đầy đủ.

- Khi cần đối tượng mới, gọi phương thức clone() trên đối tượng ban đầu để tạo ra bản sao.

- Thay đổi các thuộc tính cần thiết trên đối tượng mới.

![](https://refactoring.guru/images/patterns/diagrams/prototype/structure.png)

## Cấu trúc

Prototype Pattern bao gồm các thành phần:

- Prototype: định nghĩa phương thức clone() để tạo bản sao.

- ConcretePrototype: cài đặt phương thức clone().

- Client: tạo ra đối tượng ban đầu, sau đó sử dụng prototype để clone.

## Cách triển khai

Trong Java, có 2 cách triển khai Prototype Pattern:

- Sử dụng interface Cloneable và phương thức clone() mặc định của Object.

- Tự định nghĩa interface Prototype với phương thức clone() và triển khai trên các lớp cụ thể.

## Ví dụ

```java
public class CharacterPrototype implements Cloneable {

  private String name; 
  private Armor armor;
  private Weapon weapon;

  // constructor, getter/setter

  @Override
  public CharacterPrototype clone() throws CloneNotSupportedException {
    return (CharacterPrototype) super.clone(); 
  }

}

// Tạo đối tượng ban đầu 
CharacterPrototype mario = new CharacterPrototype("Mario"); 

// Tạo đối tượng mới bằng clone
CharacterPrototype luigi = mario.clone();
luigi.setName("Luigi");
```

## So sánh với các Pattern khác

- Factory Method/Abstract Factory tạo ra đối tượng mới mỗi lần được gọi. Prototype sao chép từ đối tượng đã tồn tại.

- Builder tách quá trình khởi tạo phức tạp ra khỏi đối tượng. Prototype che giấu logic khởi tạo bằng cách clone đối tượng có sẵn.

## Kết luận

Prototype Pattern rất hữu ích khi quá trình khởi tạo đối tượng phức tạp mà chúng ta cần tạo nhiều đối tượng tương tự. Tuy nhiên cần cân nhắc chi phí clone so với tạo mới khi áp dụng.